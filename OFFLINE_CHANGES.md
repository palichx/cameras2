# Изменения для локальной сети (без интернета)

## Сделанные изменения ✅

### 1. Удалены внешние зависимости

**Frontend (`/app/frontend/src/App.css`):**
- ❌ Удалено: Google Fonts (Space Grotesk, Inter)
- ✅ Добавлено: Системные шрифты
  ```css
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto'...
  ```

### 2. Убраны CORS ограничения

**Backend (`/app/backend/server.py`):**
```python
# Было:
allow_origins=os.environ.get('CORS_ORIGINS', '*').split(',')

# Стало:
allow_origins=["*"]  # Любые источники разрешены
```

**Удалено из конфигурации:**
- `backend/.env` - убрана переменная `CORS_ORIGINS`
- `docker-compose.yml` - убрана переменная `CORS_ORIGINS`
- `Dockerfile` - убрана переменная `CORS_ORIGINS`

### 3. Динамическое определение Backend URL

**Создан `/app/frontend/src/utils/api.js`:**
```javascript
export const getBackendUrl = () => {
  // Автоматическое определение по текущему hostname
  const protocol = window.location.protocol;
  const hostname = window.location.hostname;
  const port = 8001;
  return `${protocol}//${hostname}:${port}`;
};
```

**Обновлены все компоненты:**
- `pages/Dashboard.js`
- `pages/AddCamera.js`
- `pages/CameraView.js`
- `pages/RecordingsView.js`
- `components/ZoneEditor.js`
- `components/VideoPlayer.js`

Теперь используют `import { getBackendUrl } from '../utils/api'`

### 4. Работа с любым hostname

Приложение теперь работает с:
- `http://localhost:8001`
- `http://127.0.0.1:8001`
- `http://192.168.1.100:8001` (локальная сеть)
- `http://10.0.0.5:8001` (другая подсеть)
- `http://server-name:8001` (по имени хоста)

### 5. Созданы скрипты и документация

**Новые файлы:**

1. **`LOCAL_NETWORK_SETUP.md`**
   - Полная инструкция по настройке локальной сети
   - Примеры доступа с разных устройств
   - Настройка firewall
   - Подключение IP камер
   - Troubleshooting

2. **`scripts/setup-local-network.sh`**
   - Автоматическая настройка для локальной сети
   - Определение IP адреса
   - Настройка firewall
   - Запуск Docker
   - Вывод инструкций по доступу

3. **`DOCKER_ARCHITECTURE.md`**
   - Подробная архитектура Docker
   - Что включено в образ
   - Схемы компонентов

4. **Обновлен `README.md`**
   - Добавлен раздел о локальной сети
   - Инструкция по быстрому старту
   - Примеры доступа

## Проверка автономности

### ✅ Что НЕ требует интернета:

1. **Шрифты**: Системные шрифты ОС
2. **Библиотеки**: Все в node_modules и Python packages
3. **API**: Только локальные вызовы
4. **Стили**: Все CSS локальные
5. **Изображения**: Все ассеты упакованы

### ✅ Работает в изолированной сети:

- Сервер и клиенты в одной локальной сети
- Без доступа в интернет
- Без DNS (можно использовать IP)
- Без внешних CDN или API

## Примеры использования

### Сценарий 1: Домашняя сеть

```
Сервер: 192.168.1.100
Камера 1: 192.168.1.150 (rtsp://...)
Камера 2: 192.168.1.151 (rtsp://...)
Телефон: 192.168.1.200

Доступ с телефона: http://192.168.1.100:8001
```

### Сценарий 2: Офисная сеть

```
Сервер: 10.0.10.50
Камеры: 10.0.10.60-70
ПК охраны: 10.0.10.100

Доступ: http://10.0.10.50:8001
```

### Сценарий 3: WiFi Hotspot

```
Ноутбук (hotspot): 192.168.43.1
USB камера или сетевая камера
Телефон подключен к hotspot

Доступ: http://192.168.43.1:8001
```

## Тестирование

### Проверка без интернета:

1. Отключите интернет на сервере
2. Запустите: `docker-compose up -d`
3. Откройте с другого ПК: `http://<server-ip>:8001`
4. ✅ Должно работать полностью

### Проверка CORS:

```bash
# С любого хоста должно работать
curl -H "Origin: http://192.168.1.50" http://192.168.1.100:8001/api/cameras

# Ответ должен содержать заголовки CORS
```

## Безопасность

**⚠️ Внимание:**
- Нет аутентификации (по требованиям)
- CORS разрешен для всех (для локальной сети)
- Используйте только в доверенной сети
- НЕ открывайте порт 8001 в интернет

**Рекомендации:**
1. Настройте firewall на сервере
2. Используйте VPN для удаленного доступа
3. Регулярно обновляйте пароли на камерах

## Команды для проверки

```bash
# Запуск
./scripts/setup-local-network.sh

# Или вручную
docker-compose up -d

# Узнать IP сервера
ip addr show | grep inet

# Проверить доступность
curl http://localhost:8001/api/cameras

# С другого ПК
curl http://192.168.1.100:8001/api/cameras

# Логи
docker-compose logs -f app
```

## Результат

✅ Приложение полностью автономно
✅ Работает без интернета
✅ Работает с любым IP/hostname
✅ Нет ограничений CORS
✅ Все скрипты локальные
✅ Готово к использованию в изолированной сети
