# Быстрое тестирование системы без реальных камер

## Проблема

Для тестирования системы нужны RTSP камеры, но их может не быть под рукой.

## Решение: Тестовые RTSP стримы

### Вариант 1: Публичные тестовые камеры

Используйте бесплатные публичные RTSP стримы для тестирования:

```
1.Axis Test Camera:
   rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov

2. Wowza Test Stream:
   rtsp://wowzaec2demo.streamlock.net/vod/mp4:sample.mp4

3. MediaMTX Test (если доступен):
   rtsp://localhost:8554/mystream
```

### Вариант 2: Создать локальный RTSP сервер

#### Используя FFmpeg (простейший способ):

```bash
# 1. Создайте тестовое видео или используйте существующее
# 2. Запустите RTSP сервер с помощью MediaMTX

# Установка MediaMTX
wget https://github.com/bluenviron/mediamtx/releases/download/v1.0.0/mediamtx_v1.0.0_linux_amd64.tar.gz
tar -xzf mediamtx_v1.0.0_linux_amd64.tar.gz
./mediamtx &

# В другом терминале - стрим видео в MediaMTX
ffmpeg -re -stream_loop -1 -i test_video.mp4 -c copy -f rtsp rtsp://localhost:8554/mystream
```

#### Или используя Docker:

```bash
# Запустите RTSP сервер
docker run -d \
  --name rtsp-server \
  -p 8554:8554 \
  bluenviron/mediamtx:latest

# Стримите видео
ffmpeg -re -stream_loop -1 -i test_video.mp4 \
  -c copy -f rtsp rtsp://localhost:8554/test
```

### Вариант 3: Webcam как RTSP

Если у вас есть веб-камера:

```bash
# Linux
ffmpeg -f v4l2 -i /dev/video0 -f rtsp rtsp://localhost:8554/webcam

# macOS
ffmpeg -f avfoundation -i "0" -f rtsp rtsp://localhost:8554/webcam

# Windows
ffmpeg -f dshow -i video="Webcam" -f rtsp rtsp://localhost:8554/webcam
```

## Тестирование системы

### Шаг 1: Добавьте тестовую камеру

1. Откройте приложение: `http://localhost:8001`
2. Нажмите "Add Camera"
3. Заполните форму:
   ```
   Name: Test Camera
   URL: rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov
   Username: (оставьте пустым)
   Password: (оставьте пустым)
   ```
4. Нажмите "Add Camera"

### Шаг 2: Запустите камеру

1. На дашборде найдите добавленную камеру
2. Нажмите "Start Camera"
3. Подождите 5-10 секунд для подключения
4. Статус должен измениться на "active"

### Шаг 3: Просмотр Live

1. Нажмите "View Live" на карточке камеры
2. Вы должны увидеть live stream
3. Попробуйте вкладки:
   - Live Preview
   - Зоны исключения
   - Детектор движения

### Шаг 4: Настройка детектора движения

1. Перейдите на вкладку "Детектор движения"
2. Включите "Запись при движении"
3. Настройте параметры:
   - Чувствительность: 25 (для теста)
   - Предзапись: 5 сек
   - Постзапись: 10 сек
4. Сохраните настройки

### Шаг 5: Тестирование зон исключения

1. Перейдите на вкладку "Зоны исключения"
2. Нажмите "Обновить изображение" - должен загрузиться снимок с камеры
3. Нажмите "Начать рисование зоны"
4. Кликайте на изображение чтобы создать полигон (минимум 3 точки)
5. Нажмите "Завершить зону"
6. Сохраните зоны

### Шаг 6: Запись

Два варианта записи:

**Автоматическая (по движению):**
- Если настроен детектор движения - запись начнется автоматически при обнаружении движения

**Ручная:**
- Нажмите "Начать запись вручную" в верхнем правом углу
- Индикатор REC появится на видео
- Нажмите "Остановить запись" когда нужно

### Шаг 7: Просмотр записей

1. Вернитесь на дашборд (кнопка "Назад к камерам")
2. Нажмите "Recordings" в верхнем меню
3. Найдите свою запись в списке
4. Нажмите "Play" для воспроизведения
5. Используйте кнопки скорости (x1, x2, x4, x6, x8, x10)

## Проверка функций

### ✅ Чек-лист тестирования:

- [ ] Добавление камеры работает
- [ ] Start Camera подключается к потоку
- [ ] Live preview показывает видео
- [ ] WebSocket работает (видео обновляется)
- [ ] Настройки детектора сохраняются
- [ ] Редактор зон показывает снимок с камеры
- [ ] Можно нарисовать зоны исключения
- [ ] Ручная запись работает (Start/Stop Recording)
- [ ] Автоматическая запись при движении работает
- [ ] Записи появляются в списке Recordings
- [ ] Видео плеер воспроизводит записи
- [ ] Ускорение воспроизведения работает (x2-x10)
- [ ] Скачивание записей работает (Download)

## Troubleshooting

### Камера не подключается

**Проверьте логи:**
```bash
docker-compose logs -f app | grep -i "camera\|error"
```

**Типичные проблемы:**
- Неверный URL
- Камера недоступна
- Кодек не поддерживается (HEVC)

**Решение для HEVC:**
Используйте H.264 поток или тестовую камеру с H.264.

### Live preview черный экран

**Причины:**
1. WebSocket не подключен
2. Камера не отправляет кадры
3. Проблема с кодеком

**Проверка:**
```bash
# Проверьте что камера active
curl http://localhost:8001/api/cameras

# Проверьте WebSocket в браузере (Console -> Network -> WS)
```

### Запись не работает

**Проверьте:**
1. Папка recordings существует: `ls -la /app/backend/recordings`
2. Права на запись: `chmod 777 /app/backend/recordings`
3. Место на диске: `df -h`

### Видео не воспроизводится

**Проверьте:**
1. Файл существует: `ls -la /app/backend/recordings/`
2. Размер файла больше 0
3. Браузер поддерживает формат (используйте Chrome/Firefox)

## Полезные команды

```bash
# Просмотр всех камер
curl http://localhost:8001/api/cameras | jq

# Просмотр всех записей
curl http://localhost:8001/api/recordings | jq

# Остановить все камеры
docker-compose restart app

# Очистить все записи
rm -rf /app/backend/recordings/*

# Посмотреть размер записей
du -sh /app/backend/recordings/

# Проверить CPU использование
docker stats surveillance-app
```

## Рекомендации для продакшена

1. **Используйте H.264 камеры** - лучшая совместимость
2. **Настройте статический IP** для сервера
3. **Используйте качественные камеры** с хорошим bitrate
4. **Мониторьте место на диске** - записи занимают много места
5. **Настройте rotation записей** - удаление старых файлов
6. **Используйте SSD** для лучшей производительности
7. **Выделите достаточно CPU** - минимум 2 ядра для 4 камер

## Примеры тестовых видео

Скачайте тестовые видео для локального RTSP сервера:

```bash
# Big Buck Bunny (открытый контент)
wget https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4

# Используйте с MediaMTX
ffmpeg -re -stream_loop -1 -i Big_Buck_Bunny_360_10s_1MB.mp4 \
  -c copy -f rtsp rtsp://localhost:8554/test
```

Затем добавьте в приложение:
```
URL: rtsp://localhost:8554/test
```

---

**Готово!** Теперь вы можете полностью протестировать систему без реальных камер.
