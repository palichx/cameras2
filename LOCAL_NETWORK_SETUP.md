# Настройка для локальной сети (без интернета)

## Автономная работа ✅

Приложение полностью автономно и работает без доступа в интернет:

### ✅ Что работает офлайн:

1. **Frontend**
   - ❌ Убраны Google Fonts
   - ✅ Используются системные шрифты
   - ✅ Все библиотеки упакованы в node_modules
   - ✅ Нет CDN зависимостей

2. **Backend**
   - ✅ Все Python библиотеки локальные
   - ✅ OpenCV, FFmpeg установлены в контейнере
   - ✅ Нет внешних API вызовов

3. **CORS**
   - ✅ Разрешены все источники (`allow_origins=["*"]`)
   - ✅ Работает с любым hostname/IP

4. **Динамическое определение URL**
   - ✅ Автоматическое определение backend URL
   - ✅ Работает с любым IP адресом
   - ✅ Работает с любым портом

## Доступ в локальной сети

### Вариант 1: Docker (рекомендуется)

1. **На сервере/ПК запустите:**
```bash
cd /app
docker-compose up -d
```

2. **Узнайте IP адрес сервера:**
```bash
# Linux/Mac
ip addr show | grep inet

# Windows
ipconfig

# Пример вывода: 192.168.1.100
```

3. **С любого устройства в сети откройте:**
```
http://192.168.1.100:8001
```

### Вариант 2: Локальный запуск

**На сервере:**

1. Backend:
```bash
cd /app/backend
python -m uvicorn server:app --host 0.0.0.0 --port 8001
```

2. Frontend (в другом терминале):
```bash
cd /app/frontend
# Создайте .env.local с динамическим URL
echo "REACT_APP_BACKEND_URL=http://$(hostname -I | awk '{print $1}'):8001" > .env.local
yarn start
```

**С других устройств:**
```
http://<IP-сервера>:3000  # Frontend
http://<IP-сервера>:8001  # Backend API
```

## Примеры доступа

### Разные способы подключения:

1. **Localhost (на том же ПК):**
   ```
   http://localhost:8001
   http://127.0.0.1:8001
   ```

2. **Локальная сеть (с других ПК):**
   ```
   http://192.168.1.100:8001
   http://192.168.0.50:8001
   http://10.0.0.5:8001
   ```

3. **По имени хоста:**
   ```
   http://server-pc:8001
   http://surveillance-server:8001
   ```

4. **WiFi hotspot:**
   ```
   http://192.168.43.1:8001
   ```

Все варианты работают без изменения конфигурации!

## Настройка сетевого доступа

### Linux (Ubuntu/Debian):

```bash
# Разрешить порт в firewall
sudo ufw allow 8001/tcp

# Проверить IP адрес
ip addr show
```

### Windows:

1. Откройте **Windows Defender Firewall**
2. **Inbound Rules** → **New Rule**
3. Port: 8001, TCP
4. Allow the connection

```powershell
# PowerShell: узнать IP
ipconfig
```

### macOS:

```bash
# Разрешить входящие подключения в System Preferences → Security

# Узнать IP
ifconfig | grep "inet "
```

## Проверка доступности

### На сервере:

```bash
# Проверка что сервис работает
curl http://localhost:8001/api/cameras

# Проверка на всех интерфейсах
netstat -tulpn | grep 8001
```

### С клиентского устройства:

```bash
# Ping сервера
ping 192.168.1.100

# Проверка доступа к API
curl http://192.168.1.100:8001/api/cameras

# Или откройте в браузере
http://192.168.1.100:8001
```

## Подключение IP камер

### Камеры должны быть в той же сети:

1. **Найдите IP камеры:**
   ```bash
   # Сканирование сети (Linux)
   nmap -sn 192.168.1.0/24
   
   # Или используйте веб-интерфейс камеры
   ```

2. **Добавьте камеру в приложении:**
   ```
   URL: rtsp://192.168.1.150:554/stream1
   Username: admin
   Password: password123
   ```

3. **Примеры RTSP URL:**
   ```
   rtsp://192.168.1.150:554/stream1
   rtsp://admin:password@192.168.1.150:554/h264
   http://192.168.1.150:8080/video
   ```

## Статический IP (рекомендуется)

Для стабильной работы назначьте серверу статический IP:

### Ubuntu/Debian:

Edit `/etc/netplan/01-netcfg.yaml`:
```yaml
network:
  version: 2
  ethernets:
    eth0:
      addresses:
        - 192.168.1.100/24
      gateway4: 192.168.1.1
      nameservers:
        addresses:
          - 8.8.8.8
          - 8.8.4.4
```

Apply:
```bash
sudo netplan apply
```

### Windows:

1. Network Settings → Ethernet → Properties
2. IPv4 Properties
3. Use the following IP address:
   - IP: 192.168.1.100
   - Subnet: 255.255.255.0
   - Gateway: 192.168.1.1

## Мобильные устройства

С телефонов/планшетов в той же WiFi сети:

1. Подключитесь к той же WiFi
2. Откройте браузер
3. Введите: `http://192.168.1.100:8001`
4. Приложение адаптивно и работает на мобильных

## Множественный доступ

- ✅ Несколько пользователей могут одновременно подключаться
- ✅ Live stream работает для всех подключенных клиентов
- ✅ WebSocket поддерживает множественные соединения

## Без аутентификации

Согласно требованиям, аутентификация пользователей не реализована.

**Рекомендации для безопасности:**
- Используйте только в доверенной локальной сети
- Настройте firewall для блокировки внешнего доступа
- Не открывайте порт 8001 в интернет

## Troubleshooting

### Не могу подключиться с другого ПК:

1. Проверьте firewall на сервере
2. Проверьте что сервис запущен: `docker-compose ps`
3. Проверьте IP адрес: `ip addr show`
4. Ping сервер с клиента
5. Проверьте что устройства в одной подсети

### WebSocket не работает:

1. Проверьте что порт 8001 открыт
2. Убедитесь что используется правильный протокол (ws:// или wss://)
3. Приложение автоматически определяет протокол

### Камера не подключается:

1. Проверьте что камера в той же сети
2. Проверьте RTSP URL и credentials
3. Попробуйте открыть RTSP в VLC: `vlc rtsp://camera-ip:554/stream1`
4. Проверьте логи: `docker-compose logs -f app`
